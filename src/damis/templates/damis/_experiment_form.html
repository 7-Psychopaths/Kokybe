{% load i18n %}
{% get_current_language as lang %}

<form id="experiment-form" action="." method="post" autocomplete="off">{% csrf_token %}
    {% if experiment_form.errors %}
        <div class="error-message">
            {% trans "Form contains errors" %}
        </div>
    {% endif %}
    <input id="id_title" type="text" name="title" maxlength="255" placeholder="{% trans "Title" %}" value="{% if experiment_form.title.value %}{{ experiment_form.title.value }}{% endif %}" style="margin-bottom:0"/>
    <input id="id_workflow_state" type="hidden" name="workflow_state" value="{% if experiment_form.workflow_state.value %}{{ experiment_form.workflow_state.value }}{% endif %}" />
    <button class="btn" type="button" id="save-btn">{% trans "Save" %}</button>
    <button class="btn btn-primary"
            type="button" id="execute-btn">{% trans "Execute" %}</button>
    {{ task_formset.management_form }}
    <div style="display: none;">
        {% for task in task_formset.forms %}
        {% trans 'Task' %}
        <div class="inline task">
            <div>
                {{ task.non_field_errors }}
                {% for field in task.visible_fields %}
                    <p>{{ field.errors}}
                    {{ field.label }}:<br/>
                    {% if field.name == 'algorithm' %} 
                    <span class='algorithm-selection'>{{ field }}</span>
                    {% else %}
                    {{ field }}
                    {% endif %}
                    </p>
                {% endfor %}
                {% for field in task.hidden_fields %}
                    {{ field }}
                {% endfor %}
            </div>
        </div>
        <div class="parameter-values">
            {% for param_formset in task.parameter_values %}
                {% include 'dynamic/parameter_form.html' with formset=param_formset %}
            {% endfor %}
        </div>
        {% endfor %}
    </div> 
    <div id="data-input-container" style="display:none;">{{ dataset_form.as_p }}</div>
    <div id="task-forms"></div>
</form>
